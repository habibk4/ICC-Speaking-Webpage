<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙ…Ø±ÛŒÙ† Ø²Ø¨Ø§Ù† Ø¯ÙˆØ±Ù‡ ICC - Ø¬Ù„Ø³Ù‡ Û³Û³</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: #f1f5f9; /* slate-100 */
        }
        .main-container {
            flex-grow: 1;
        }
        .flashcard-container { perspective: 1000px; height: 320px; width: 100%; max-width: 600px; }
        .flashcard { position: relative; width: 100%; height: 100%; transition: transform 0.7s; transform-style: preserve-3d; }
        .flashcard.is-flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 1.5rem; border-radius: 1rem; box-shadow: 0 8px 24px rgba(0,0,0,0.1); text-align: center; border: 1px solid #e2e8f0; }
        .card-front { background-color: #ffffff; }
        .card-back { background-color: #f8fafc; transform: rotateY(180deg); }
        .pronunciation-button { display: inline-flex; align-items: center; gap: 0.5rem; margin-top: 1rem; padding: 0.5rem 1rem; background-color: #e0f2fe; color: #0c4a6e; border-radius: 9999px; font-weight: 500; transition: all 0.2s; border: none; cursor: pointer; }
        .pronunciation-button:hover { background-color: #bae6fd; transform: scale(1.05); }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }
        .menu-card {
            transition: all 0.3s ease-in-out;
        }
        .menu-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .lesson-content .proverb-banner {
            background-image: linear-gradient(to left, #dc2626, #ef4444);
            color: white;
            padding: 2rem;
            border-radius: 1rem;
            margin-top: 3rem;
            text-align: center;
            box-shadow: 0 10px 20px -5px rgba(239, 68, 68, 0.4);
        }
        .lesson-content .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 350px;
        }
        @media (min-width: 768px) {
            .lesson-content .chart-container {
                height: 350px;
            }
        }
        .lesson-content .tip-box {
            background-color: #e0f2fe; /* Sky 100 */
            border-right: 4px solid #0ea5e9; /* Sky 500 */
            color: #0c4a6e; /* Sky 900 */
        }
        .lesson-content .warning-box {
            background-color: #fffbeb; /* Amber 50 */
            border-right: 4px solid #f59e0b; /* Amber 500 */
            color: #92400e; /* Amber 900 */
        }
        .action-buttons {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        .action-buttons .btn {
            padding: 0.75rem 2rem;
            font-weight: bold;
            border-radius: 0.75rem;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
        }
        .action-buttons .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .btn-correct {
            background-color: #10b981; /* green-500 */
            color: white;
        }
        .btn-incorrect {
            background-color: #ef4444; /* red-500 */
            color: white;
        }
        .highlight {
            color: #10b981; /* green-500 */
            font-weight: bold;
            position: relative;
            cursor: pointer;
        }

        .highlight .tooltip-text {
            visibility: hidden;
            width: 150px;
            background-color: #4b5563; /* slate-700 */
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 0;
            position: absolute;
            z-index: 1;
            bottom: 125%; /* Position the tooltip above the text */
            left: 50%;
            margin-left: -75px;
            opacity: 0;
            transition: opacity 0.3s;
            font-family: 'Vazirmatn', sans-serif;
        }

        .highlight:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <div class="main-container container mx-auto max-w-6xl p-4 sm:p-8">
        <header class="text-center mb-8 sm:mb-12 fade-in">
            <h1 class="text-3xl sm:text-4xl font-bold text-slate-800">ØªÙ…Ø±ÛŒÙ† Ø²Ø¨Ø§Ù† Ø¯ÙˆØ±Ù‡ ICC - Ø¬Ù„Ø³Ù‡ Û³Û³</h1>
            <p id="header-subtitle" class="text-slate-500 mt-2">ÛŒÚ© Ø¨Ø®Ø´ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ ØªÙ…Ø±ÛŒÙ† Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.</p>
        </header>

        <!-- Main Menu View -->
        <div id="main-menu-view" class="fade-in" style="animation-delay: 0.2s;">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <!-- Lesson 33 Card -->
                <div id="start-lesson33-btn" class="menu-card bg-white rounded-2xl shadow-lg p-8 text-center cursor-pointer">
                    <div class="text-5xl text-purple-500 mb-4">âœ¨</div>
                    <h2 class="text-2xl font-bold text-slate-800">Ø¯Ø±Ø³ Ø¬Ù„Ø³Ù‡ Û³Û³</h2>
                    <p class="text-slate-500 mt-2">Ú¯Ø±Ø§Ù…Ø± Ø³ÙˆØ§Ù„Ø§Øª ØªÙˆ Ø¯Ø± ØªÙˆ (Embedded Questions).</p>
                </div>
                <!-- Story Card -->
                <div id="start-story-btn" class="menu-card bg-white rounded-2xl shadow-lg p-8 text-center cursor-pointer">
                    <div class="text-5xl text-fuchsia-500 mb-4">ğŸ“–</div>
                    <h2 class="text-2xl font-bold text-slate-800">Ø¯Ø§Ø³ØªØ§Ù†</h2>
                    <p class="text-slate-500 mt-2">Ù…Ø±ÙˆØ± Ú¯Ø±Ø§Ù…Ø± Ùˆ Ú©Ù„Ù…Ø§Øª Ø¯Ø± Ù‚Ø§Ù„Ø¨ ÛŒÚ© Ø¯Ø§Ø³ØªØ§Ù† Ø¬Ø°Ø§Ø¨.</p>
                </div>
                <!-- Vocab Card -->
                <div id="start-vocab-btn" class="menu-card bg-white rounded-2xl shadow-lg p-8 text-center cursor-pointer">
                    <div class="text-5xl text-blue-500 mb-4">ğŸ”¤</div>
                    <h2 class="text-2xl font-bold text-slate-800">ØªÙ…Ø±ÛŒÙ† Ú©Ù„Ù…Ø§Øª Ùˆ Ø§ØµØ·Ù„Ø§Ø­Ø§Øª</h2>
                    <p class="text-slate-500 mt-2">ÙˆØ§Ú˜Ú¯Ø§Ù†ØŒ Ø§ØµØ·Ù„Ø§Ø­Ø§Øª Ùˆ Ø¹Ø¨Ø§Ø±Ø§Øª Ú©Ø§Ø±Ø¨Ø±Ø¯ÛŒ Ø±Ø§ Ù…Ø±ÙˆØ± Ú©Ù†ÛŒØ¯.</p>
                </div>
                <!-- Grammar Card -->
                <div id="start-grammar-btn" class="menu-card bg-white rounded-2xl shadow-lg p-8 text-center cursor-pointer">
                    <div class="text-5xl text-teal-500 mb-4">ğŸ“</div>
                    <h2 class="text-2xl font-bold text-slate-800">ØªÙ…Ø±ÛŒÙ† Ú¯Ø±Ø§Ù…Ø±</h2>
                    <p class="text-slate-500 mt-2">Ø³Ø§Ø®ØªØ§Ø±Ù‡Ø§ÛŒ Ú¯Ø±Ø§Ù…Ø±ÛŒ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ ØªÙ…Ø±ÛŒÙ† Ú©Ù†ÛŒØ¯.</p>
                </div>
            </div>
        </div>

        <!-- Practice View (For Flashcards) -->
        <div id="practice-view" class="hidden">
            <div class="bg-white rounded-2xl shadow-xl p-6 sm:p-10">
                <div id="review-area" class="w-full mx-auto text-center">
                    <div id="flashcard-display" class="flashcard-container mx-auto mb-8">
                        <div class="flashcard">
                            <div id="card-front" class="card-face card-front"></div>
                            <div id="card-back" class="card-face card-back p-0"></div>
                        </div>
                    </div>
                    <div id="interactive-buttons" class="action-buttons">
                        <button id="did-not-know-btn" class="btn btn-incorrect">Ø¨Ù„Ø¯ Ù†Ø¨ÙˆØ¯Ù…</button>
                        <button id="knew-it-btn" class="btn btn-correct">Ø¨Ù„Ø¯ Ø¨ÙˆØ¯Ù…</button>
                    </div>
                    <div class="flex justify-center items-center gap-4 mt-8 border-t border-slate-200 pt-6">
                        <button id="prev-card-btn" class="px-6 py-3 text-sm font-bold bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-lg transition">Ù‚Ø¨Ù„ÛŒ</button>
                        <p id="card-counter" class="text-slate-500 font-medium text-sm w-20 text-center"></p>
                        <button id="next-card-btn" class="px-6 py-3 text-sm font-bold bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-lg transition">Ø¨Ø¹Ø¯ÛŒ</button>
                    </div>
                </div>
                <div class="text-center mt-8 border-t border-slate-200 pt-6">
                    <button class="back-to-menu-btn text-sm text-blue-600 hover:underline font-semibold">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ</button>
                </div>
            </div>
        </div>

        <!-- Lesson View -->
        <div id="lesson-view" class="hidden">
            <div id="lesson-content-container" class="bg-white rounded-2xl shadow-xl p-8 sm:p-12 lesson-content">
                <!-- Lesson content will be injected here by JS -->
                <div class="text-center mt-10 border-t border-slate-200 pt-6">
                    <button class="back-to-menu-btn text-sm text-blue-600 hover:underline font-semibold">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ</button>
                </div>
            </div>
        </div>

        <!-- Story View -->
        <div id="story-view" class="hidden">
            <div id="story-content-container" class="bg-white rounded-2xl shadow-xl p-8 sm:p-12 lesson-content" dir="ltr">
                <!-- Story content will be injected here by JS -->
                <div class="text-center mt-10 border-t border-slate-200 pt-6">
                    <button class="back-to-menu-btn text-sm text-blue-600 hover:underline font-semibold">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ</button>
                </div>
            </div>
        </div>

        <!-- Results View -->
        <div id="results-view" class="hidden">
             <div class="bg-white rounded-2xl shadow-xl p-6 sm:p-10 text-center">
                <h2 class="text-2xl sm:text-3xl font-bold text-slate-800 mb-4">Ù†ØªØ§ÛŒØ¬ ØªÙ…Ø±ÛŒÙ†</h2>
                <div id="results-stats" class="text-lg text-slate-700 mb-6"></div>
                <button id="save-results-btn" class="px-6 py-3 text-sm font-bold bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition mb-4">Ø°Ø®ÛŒØ±Ù‡ Ù†ØªØ§ÛŒØ¬</button>
                <div id="save-message" class="text-sm font-medium text-green-700"></div>
                <div class="text-center mt-8 border-t border-slate-200 pt-6">
                    <button class="back-to-menu-btn text-sm text-blue-600 hover:underline font-semibold">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ</button>
                </div>
            </div>
        </div>
        
    </div>
    
    <footer class="text-center p-4 mt-auto text-slate-500 text-sm">
        <p>Ø·Ø±Ø§Ø­ÛŒ Ùˆ ØªÙˆØ³Ø¹Ù‡ Ø­Ø¨ÛŒØ¨ Ú©Ù…Ø§ÛŒÛŒ</p>
        <p>Habibkamaie@gmail.com</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        document.addEventListener('DOMContentLoaded', async function () {
            // --- Firebase Setup ---
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
            const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : '';
            
            let db, auth, userId;
            let firebaseInitialized = false;

            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                firebaseInitialized = true;
                console.log("Firebase initialized successfully.");

                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        console.log("User authenticated with UID:", userId);
                    } else {
                        console.log("User signed out.");
                    }
                });

            } catch (error) {
                console.error("Firebase initialization or authentication failed:", error);
            }

            // --- UI Elements ---
            const mainMenuView = document.getElementById('main-menu-view');
            const practiceView = document.getElementById('practice-view');
            const lessonView = document.getElementById('lesson-view');
            const storyView = document.getElementById('story-view');
            const resultsView = document.getElementById('results-view');
            
            const startLesson33Btn = document.getElementById('start-lesson33-btn');
            const startStoryBtn = document.getElementById('start-story-btn');
            const startVocabBtn = document.getElementById('start-vocab-btn');
            const startGrammarBtn = document.getElementById('start-grammar-btn');

            const backToMenuBtns = document.querySelectorAll('.back-to-menu-btn');
            const headerSubtitle = document.getElementById('header-subtitle');
            const cardCounter = document.getElementById('card-counter');
            const prevCardBtn = document.getElementById('prev-card-btn');
            const nextCardBtn = document.getElementById('next-card-btn');
            const lessonContentContainer = document.getElementById('lesson-content-container');
            const storyContentContainer = document.getElementById('story-content-container');
            
            const interactiveButtons = document.getElementById('interactive-buttons');
            const knewItBtn = document.getElementById('knew-it-btn');
            const didNotKnowBtn = document.getElementById('did-not-know-btn');
            const flashcardDisplay = document.getElementById('flashcard-display');
            const resultsStats = document.getElementById('results-stats');
            const saveResultsBtn = document.getElementById('save-results-btn');
            const saveMessage = document.getElementById('save-message');

            // --- DATA ---
            const lesson33Content = [
                {
                    type: 'raw_html',
                    html: `
                        <div class="container mx-auto p-0">
                            <main class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">

                                <section class="md:col-span-2 lg:col-span-3 bg-white rounded-2xl shadow-lg p-6">
                                    <h2 class="text-3xl font-bold text-center mb-4 text-sky-600">Ù‚Ø¶ÛŒÙ‡ Ú†ÛŒÙ‡ØŸ (ØªÙØ§ÙˆØª ÙØ§Ø±Ø³ÛŒ Ùˆ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ)</h2>
                                    <p class="text-center text-gray-600 mb-8 max-w-3xl mx-auto">Ø¨Ú†Ù‡â€ŒÙ‡Ø§ Ù†Ú©ØªÙ‡ Ø§ØµÙ„ÛŒ Ø§ÛŒÙ†Ù‡: ØªÙˆ ÙØ§Ø±Ø³ÛŒ ÙˆÙ‚ØªÛŒ Ù…ÛŒâ€ŒÚ¯ÛŒÙ… Â«Ù…ÛŒØ´Ù‡ Ø¨Ú¯ÛŒ Ø§Ø³Ù…Øª Ú†ÛŒÙ‡ØŸÂ»ØŒ ÙÙ‚Ø· Ø¢Ù‡Ù†Ú¯ ØµØ¯Ø§Ù…ÙˆÙ† Ø¹ÙˆØ¶ Ù…ÛŒØ´Ù‡. ÙˆÙ„ÛŒ ØªÙˆ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø§Ú¯Ù‡ Ø³Ø§Ø®ØªØ§Ø± Ø¬Ù…Ù„Ù‡ Ø±Ùˆ Ø¹ÙˆØ¶ Ù†Ú©Ù†ÛŒÙ†ØŒ Ú¯ÙˆØ´ Ø·Ø±Ù Ù…Ù‚Ø§Ø¨Ù„ Ø§Ø±ÙˆØ± Ù…ÛŒØ¯Ù‡! Ø§Ù†Ú¯Ø§Ø± ØºÙ„Ø· Ø­Ø±Ù Ø²Ø¯ÛŒÙ†.</p>
                                    <div class="flex flex-col md:flex-row items-center justify-around gap-8">
                                        <div class="text-center w-full md:w-1/2">
                                            <h3 class="text-xl font-bold mb-4 text-sky-700">ÙØ§Ø±Ø³ÛŒ: ÙÙ‚Ø· ØªØºÛŒÛŒØ± Ø¢Ù‡Ù†Ú¯ ğŸ”Š</h3>
                                            <div class="bg-gray-50 p-4 rounded-lg border-r-4 border-sky-500">
                                                <p class="font-mono">"Ø§Ø³Ù…Øª Ú†ÛŒÙ‡ØŸ" (Ø¢Ù‡Ù†Ú¯ Ø³Ø¤Ø§Ù„ÛŒ)</p>
                                                <p class="font-bold text-2xl my-2 text-sky-500">â†“</p>
                                                <p class="font-mono">"Ù…ÛŒØ´Ù‡ Ø¨Ú¯ÛŒ <span class="font-bold text-sky-600">Ø§Ø³Ù…Øª Ú†ÛŒÙ‡</span>ØŸ" (Ø¢Ù‡Ù†Ú¯ Ø®Ø¨Ø±ÛŒ)</p>
                                            </div>
                                        </div>
                                        <div class="w-full md:w-1/2 text-center">
                                            <h3 class="text-xl font-bold mb-4 text-sky-700">Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ: ØªØºÛŒÛŒØ± Ø³Ø§Ø®ØªØ§Ø± âš™ï¸</h3>
                                             <div class="bg-gray-50 p-4 rounded-lg border-r-4 border-sky-500">
                                                <p class="font-mono">"What <span class="text-red-500">is your name</span>?" (Ø³Ø§Ø®ØªØ§Ø± Ø³Ø¤Ø§Ù„ÛŒ)</p>
                                                <p class="font-bold text-2xl my-2 text-sky-500">â†“</p>
                                                <p class="font-mono">"Can you tell me what <span class="font-bold text-green-600">your name is</span>?" (Ø³Ø§Ø®ØªØ§Ø± Ø®Ø¨Ø±ÛŒ)</p>
                                            </div>
                                        </div>
                                    </div>
                                </section>

                                <section class="md:col-span-2 lg:col-span-3 bg-white rounded-2xl shadow-lg p-6">
                                    <h2 class="text-3xl font-bold text-center mb-8 text-sky-600">Ø¯Ùˆ Ù‚Ø§Ù†ÙˆÙ† Ø·Ù„Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ± Ø³Ø§Ø®ØªØ§Ø±</h2>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                        
                                        <div class="bg-gray-50 p-6 rounded-lg border-t-4 border-violet-500">
                                            <h3 class="text-xl font-bold text-center mb-4 text-violet-700">Û±. Ù‚Ø§Ù†ÙˆÙ† Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ (Ø³ÙˆÛŒÚ† Ú©Ù†!) <span class="inline-block ml-2 text-2xl align-middle">ğŸ¤</span></h3>
                                            <p class="text-center text-sm mb-6 text-gray-500">Ø¨Ø±Ø§ÛŒ ÙØ¹Ù„â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ ØªÙˆ Ø³Ø¤Ø§Ù„ Ø§ØµÙ„ÛŒ ÙÙ‚Ø· Ø¬Ø§Ø¨Ø¬Ø§ Ø´Ø¯Ù†ØŒ Ú©Ø§ÙÛŒÙ‡ Ø¨Ø±Ø¹Ú©Ø³ Ø¹Ù…Ù„ Ú©Ù†ÛŒ Ùˆ Ø¨Ø±Ø´ Ú¯Ø±Ø¯ÙˆÙ†ÛŒ Ø³Ø± Ø¬Ø§Ø´ (Ø¨Ø¹Ø¯ Ø§Ø² ÙØ§Ø¹Ù„).</p>
                                            <div class="space-y-4 text-sm mb-6">
                                                <p class="font-bold text-violet-600">â–ªï¸ Ø§ÙØ¹Ø§Ù„ to be (am/is/are/was/were):</p>
                                                <p class="pl-4">â€¢ What time <strong class="text-red-500">is it</strong>? â†’ I wonder what time <strong class="text-green-600">it is</strong>.</p>
                                                <p class="font-bold text-violet-600">â–ªï¸ Ø­Ø§Ù„ Ú©Ø§Ù…Ù„ (have/has):</p>
                                                <p class="pl-4">â€¢ Where <strong class="text-red-500">has he gone</strong>? â†’ Do you know where <strong class="text-green-600">he has gone</strong>?</p>
                                                <p class="font-bold text-violet-600">â–ªï¸ Ø§ÙØ¹Ø§Ù„ Ù…ÙØ¯Ø§Ù„ (can/will/should):</p>
                                                <p class="pl-4">â€¢ Where <strong class="text-red-500">can I sit</strong>? â†’ Tell me where <strong class="text-green-600">I can sit</strong>.</p>
                                            </div>
                                            <div class="tip-box p-3 rounded-lg text-sm">
                                               <p class="font-bold">Ù†Ú©ØªÙ‡: ÛŒØ§Ø¯Øª Ø¨Ø§Ø´Ù‡ Ø§Ù†Ú¯Ø´ØªØª Ø±Ùˆ Ø³ÙˆÛŒÚ† Ú©Ù†ÛŒ! Ø¬Ø§ÛŒ ÙØ§Ø¹Ù„ Ùˆ ÙØ¹Ù„ Ø±Ùˆ Ø¹ÙˆØ¶ Ú©Ù†.</p>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-gray-50 p-6 rounded-lg border-t-4 border-rose-500">
                                            <h3 class="text-xl font-bold text-center mb-4 text-rose-700">Û². Ù‚Ø§Ù†ÙˆÙ† Ø­Ø°Ù (Ø¶Ø±Ø¨Ø¯Ø± Ø¨Ø²Ù†!) <span class="inline-block ml-2 text-2xl align-middle">âŒ</span></h3>
                                            <p class="text-center text-sm mb-6 text-gray-500">Ø¨Ø±Ø§ÛŒ ÙØ¹Ù„â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ ÛŒÙ‡ Ú©Ù…Ú©ÛŒ (do, does, did) Ø¨Ù‡Ø´ÙˆÙ† Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ØŒ ÙÙ‚Ø· Ú©Ø§ÙÛŒÙ‡ Ø§ÙˆÙ† Ú©Ù…Ú©ÛŒ Ø±Ùˆ Ø­Ø°Ù Ú©Ù†ÛŒ Ùˆ ÙØ¹Ù„ Ø§ØµÙ„ÛŒ Ø±Ùˆ Ø¯Ø±Ø³Øª ØµØ±Ù Ú©Ù†ÛŒ.</p>
                                            <div class="space-y-4 text-sm mb-6">
                                                <p class="font-bold text-rose-600">â–ªï¸ Ø­Ø§Ù„ Ø³Ø§Ø¯Ù‡ (do/does):</p>
                                                <p class="pl-4">â€¢ Where <strong class="text-red-500">does he live</strong>? â†’ I'd like to know where he <strong class="text-green-600">lives</strong>.</p>
                                                <p class="font-bold text-rose-600">â–ªï¸ Ú¯Ø°Ø´ØªÙ‡ Ø³Ø§Ø¯Ù‡ (did):</p>
                                                <p class="pl-4">â€¢ Why <strong class="text-red-500">did she leave</strong>? â†’ I don't know why she <strong class="text-green-600">left</strong>.</p>
                                                <p class="font-bold text-rose-600">â–ªï¸ Ø³Ø§Ø®ØªØ§Ø± used to:</p>
                                                <p class="pl-4">â€¢ Where <strong class="text-red-500">did you use to</strong> play? â†’ Tell me where you <strong class="text-green-600">used to</strong> play.</p>
                                            </div>
                                            <div class="tip-box p-3 rounded-lg text-sm" style="background-color: #fee2e2; border-color: #ef4444; color: #991b1b;">
                                               <p class="font-bold">Ù†Ú©ØªÙ‡ Ù…Ù‡Ù…: Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ù‚Ø³Ù…ØªØŒ Ø±ÙˆÛŒ ÙØ¹Ù„ Ú©Ù…Ú©ÛŒ (do/does/did) Ø¶Ø±Ø¨Ø¯Ø± Ø¨Ø²Ù†ØŒ ÛŒØ¹Ù†ÛŒ Ø­Ø°ÙØ´ Ú©Ù† Ùˆ ÙØ¹Ù„ Ø§ØµÙ„ÛŒ Ø±Ùˆ ØµØ±Ù Ú©Ù†.</p>
                                            </div>
                                        </div>
                                    </div>
                                </section>

                                <section class="md:col-span-2 lg:col-span-3 bg-white rounded-2xl shadow-lg p-6">
                                    <h2 class="text-3xl font-bold text-center mb-6 text-sky-600">Ù†Ú©Ø§Øª ØªÚ©Ù…ÛŒÙ„ÛŒ Ùˆ Ø®ÙÙ†!</h2>
                                    <div class="space-y-6">
                                        <div class="warning-box p-4 rounded-lg">
                                            <h3 class="font-bold text-lg mb-2">Ø®ÛŒÙ„ÛŒ Ù…Ù‡Ù…: Ø§ÛŒÙ† Ù‚ÙˆØ§Ù†ÛŒÙ† ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø³Ø¤Ø§Ù„Ø§Øª WH-Ø¯Ø§Ø± Ù‡Ø³Øª!</h3>
                                            <p class="text-sm">Ø¨Ú†Ù‡â€ŒÙ‡Ø§ Ø­ÙˆØ§Ø³ØªÙˆÙ† Ø¨Ø§Ø´Ù‡ØŒ Ø§ÛŒÙ† Ø¯Ø§Ø³ØªØ§Ù† Ø³ÙˆÛŒÚ† Ú©Ø±Ø¯Ù† Ùˆ Ø­Ø°Ù Ú©Ø±Ø¯Ù†ØŒ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø³Ø¤Ø§Ù„â€ŒÙ‡Ø§ÛŒÛŒ Ù‡Ø³Øª Ú©Ù‡ Ø¨Ø§ <strong class="font-mono">What, Where, When, Why, Who, How</strong> Ø´Ø±ÙˆØ¹ Ù…ÛŒØ´Ù†. Ø¨Ø±Ø§ÛŒ Ø³Ø¤Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø¨Ù„Ù‡/Ø®ÛŒØ± (Ù…Ø«Ù„ Do you speak English?) ÛŒÙ‡ Ù…Ø§Ø¬Ø±Ø§ÛŒ Ø¯ÛŒÚ¯Ù‡ Ø¯Ø§Ø±ÛŒÙ… Ú©Ù‡ Ø¨Ø¹Ø¯Ø§Ù‹ Ø¨Ù‡Ø´ Ù…ÛŒâ€ŒØ±Ø³ÛŒÙ….</p>
                                        </div>
                                        <div class="tip-box p-4 rounded-lg">
                                            <h3 class="font-bold text-lg mb-2">Ø¢Ø®Ø±Ø´ Ù†Ù‚Ø·Ù‡ Ø¨Ø°Ø§Ø±Ù… ÛŒØ§ Ø¹Ù„Ø§Ù…Øª Ø³Ø¤Ø§Ù„ØŸ</h3>
                                            <p class="text-sm">Ù‚Ø§Ù†ÙˆÙ†Ø´ Ø³Ø§Ø¯Ù‡â€ŒØ³Øª: Ø¨Ù‡ Ø¬Ù…Ù„Ù‡ Ø§ÙˆÙ„ Ù†Ú¯Ø§Ù‡ Ú©Ù†. Ø§Ú¯Ù‡ Ø§ÙˆÙ† Ø³Ø¤Ø§Ù„ÛŒ Ø¨ÙˆØ¯ (Ù…Ø«Ù„ Do you know...?)ØŒ Ø¢Ø®Ø±Ø´ Ø¹Ù„Ø§Ù…Øª Ø³Ø¤Ø§Ù„ (?) Ø¨Ø°Ø§Ø±. Ø§Ú¯Ù‡ Ø®Ø¨Ø±ÛŒ ÛŒØ§ Ø§Ù…Ø±ÛŒ Ø¨ÙˆØ¯ (Ù…Ø«Ù„ I wonder... ÛŒØ§ Tell me...)ØŒ Ø¢Ø®Ø±Ø´ Ù†Ù‚Ø·Ù‡ (.) Ø¨Ø°Ø§Ø±.</p>
                                        </div>
                                    </div>
                                </section>

                                <section class="md:col-span-2 lg:col-span-3 bg-white rounded-2xl shadow-lg p-6">
                                    <h2 class="text-2xl font-bold text-center mb-4 text-sky-600">Ù…Ù‚Ø§ÛŒØ³Ù‡: \`need to\` Ø¯Ø± Ø¨Ø±Ø§Ø¨Ø± \`have to\`</h2>
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm text-center">
                                            <thead class="bg-gray-100 text-sky-800">
                                                <tr>
                                                    <th class="p-3 rounded-r-lg">ÙˆÛŒÚ˜Ú¯ÛŒ</th>
                                                    <th class="p-3">have to</th>
                                                    <th class="p-3 rounded-l-lg">need to</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="border-b">
                                                    <td class="p-3 font-bold">Ù…Ø¹Ù†ÛŒ Ø§ØµÙ„ÛŒ</td>
                                                    <td class="p-3">Ø§Ù„Ø²Ø§Ù… / Ø§Ø¬Ø¨Ø§Ø± (Obligation)</td>
                                                    <td class="p-3">Ù†ÛŒØ§Ø² / Ø¶Ø±ÙˆØ±Øª (Necessity)</td>
                                                </tr>
                                                 <tr class="bg-gray-50 border-b">
                                                    <td class="p-3 font-bold">Ù…Ù†Ø´Ø£</td>
                                                    <td class="p-3">Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¨ÛŒØ±ÙˆÙ†ÛŒ (Ù‚Ø§Ù†ÙˆÙ†ØŒ Ø¯Ø³ØªÙˆØ±)</td>
                                                    <td class="p-3">Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¯Ø±ÙˆÙ†ÛŒ (Ù†ÛŒØ§Ø² Ø´Ø®ØµÛŒØŒ Ù‡Ø¯Ù)</td>
                                                </tr>
                                                 <tr class="border-b">
                                                    <td class="p-3 font-bold">Ù…Ø«Ø§Ù„</td>
                                                    <td class="p-3 italic">"I <strong class="font-normal text-violet-600">have to</strong> wear a uniform at work."</td>
                                                    <td class="p-3 italic">"I <strong class="font-normal text-violet-600">need to</strong> sleep more."</td>
                                                </tr>
                                                 <tr class="bg-gray-50">
                                                    <td class="p-3 font-bold">Ù…Ù†ÙÛŒ</td>
                                                    <td class="p-3">Don't have to (Ù…Ø¬Ø¨ÙˆØ± Ù†ÛŒØ³ØªÛŒ)</td>
                                                    <td class="p-3">Don't need to (Ù†ÛŒØ§Ø²ÛŒ Ù†ÛŒØ³Øª)</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </section>

                                 <section class="md:col-span-2 lg:col-span-3 bg-white rounded-2xl shadow-lg p-6">
                                    <h2 class="text-2xl font-bold text-center mb-6 text-sky-600">ÙˆØ§Ú˜Ú¯Ø§Ù† Ùˆ Ø§ØµØ·Ù„Ø§Ø­Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ</h2>
                                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 text-center">
                                        <div class="bg-gray-50 p-4 rounded-lg">
                                            <p class="text-4xl mb-2">ğŸ§€</p>
                                            <h3 class="font-bold text-sky-800">Big Cheese</h3>
                                            <p class="text-sm text-gray-600">Ø¢Ø¯Ù… Ú©Ù„Ù‡â€ŒÚ¯Ù†Ø¯Ù‡ØŒ ÙØ±Ø¯ Ù…Ù‡Ù…</p>
                                            <p class="text-xs italic text-gray-500 mt-1">"He thinks he's the big cheese around here."</p>
                                        </div>
                                        <div class="bg-gray-50 p-4 rounded-lg">
                                            <p class="text-4xl mb-2">ğŸ›ï¸</p>
                                            <h3 class="font-bold text-sky-800">Duty-free Shop</h3>
                                            <p class="text-sm text-gray-600">ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø¨Ø¯ÙˆÙ† Ø¹ÙˆØ§Ø±Ø¶ Ú¯Ù…Ø±Ú©ÛŒ</p>
                                            <p class="text-xs italic text-gray-500 mt-1">"I bought this perfume at the duty-free shop."</p>
                                        </div>
                                        <div class="bg-gray-50 p-4 rounded-lg">
                                            <p class="text-4xl mb-2">ğŸš»</p>
                                            <h3 class="font-bold text-sky-800">Restroom</h3>
                                            <p class="text-sm text-gray-600">Ø³Ø±ÙˆÛŒØ³ Ø¨Ù‡Ø¯Ø§Ø´ØªÛŒ (Ù…Ø­Ù„ Ø§Ø³ØªØ±Ø§Ø­Øª)</p>
                                            <p class="text-xs italic text-gray-500 mt-1">"Excuse me, where is the restroom?"</p>
                                        </div>
                                        <div class="bg-gray-50 p-4 rounded-lg">
                                            <p class="text-4xl mb-2">ğŸ›ï¸</p>
                                            <h3 class="font-bold text-sky-800">Rome wasn't built in a day</h3>
                                            <p class="text-sm text-gray-600">Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯ Ø²Ù…Ø§Ù†â€ŒØ¨Ø± Ù‡Ø³ØªÙ†Ø¯</p>
                                            <p class="text-xs italic text-gray-500 mt-1">"Be patient with your progress. Rome wasn't built in a day."</p>
                                        </div>
                                    </div>
                                </section>
                            </main>
                        </div>
                        <div class="proverb-banner">
                            <h4 class="text-sm font-semibold opacity-80 mb-2">ğŸ Ø¶Ø±Ø¨ Ø§Ù„Ù…Ø«Ù„ Ø¬Ù„Ø³Ù‡ Û³Û³</h4>
                            <p class="text-3xl font-bold">Eleven grooms and one horse</p>
                            <p class="text-lg mt-3 opacity-90">"Ø¢ÙØªØ§Ø¨ Ù„Ú¯Ù† Ù‡ÙØª Ø§Ø³Øª Ø´Ø§Ù… Ùˆ Ù†Ø§Ù‡Ø§Ø± Ù‡ÛŒÚ†ÛŒ"</p>
                        </div>
                    `,
                    script: ``
                }
            ];

            const storyContent = [
                { type: 'h2', text: 'A Tourist\'s Questions' },
                { type: 'p', text: 'A tourist arrived at the airport and looked confused. He went to the information desk. "Excuse me," he said, "I have a few questions. First, <span class="highlight" data-fa-translation="Ù…ÛŒØ´Ù‡ Ø¨Ú¯ÛŒØ¯ Ø³Ø±ÙˆÛŒØ³ Ø¨Ù‡Ø¯Ø§Ø´ØªÛŒ Ú©Ø¬Ø§Ø³ØªØŸ">could you tell me where the restroom is</span>?" The agent smiled and pointed, "It\'s just down that <span class="highlight" data-fa-translation="Ø±Ø§Ù‡Ø±Ùˆ">hall</span>."'},
                { type: 'p', text: '"Thank you," the tourist continued. "I also <span class="highlight" data-fa-translation="Ù…ÛŒØ®ÙˆØ§Ù… Ø¨Ø¯ÙˆÙ†Ù…">want to know</span> <span class="highlight" data-fa-translation="ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø¯ÛŒÙˆØªÛŒ ÙØ±ÛŒ Ø³Ø§Ø¹Øª Ú†Ù†Ø¯ Ø¨Ø§Ø² Ù…ÛŒØ´Ù‡">what time the duty-free shop opens</span>. I <span class="highlight" data-fa-translation="Ù„Ø§Ø²Ù…Ù‡ Ú©Ù‡">need to</span> buy some gifts." The agent replied, "I\'m not sure, but <span class="highlight" data-fa-translation="Ù…ÛŒâ€ŒØ¯ÙˆÙ†ÛŒØ¯ Ø§ÙˆÙ† Ø¢Ù‚Ø§ Ú©ÛŒÙ‡ØŸ">do you know who that man is</span>? He\'s the manager, the <span class="highlight" data-fa-translation="Ú©Ù„Ù‡â€ŒÚ¯Ù†Ø¯Ù‡">big cheese</span> around here. You can ask him."' },
                { type: 'p', text: 'The tourist nodded. "One last thing. <span class="highlight" data-fa-translation="Ù…ÛŒâ€ŒØ¯ÙˆÙ†ÛŒØ¯ Ú†Ø·ÙˆØ± Ù„Ø§ØºØ± Ú©Ø±Ø¯Ù…ØŸ">Do you know how I lost weight</span> for this trip? By walking everywhere! So, <span class="highlight" data-fa-translation="Ù…ÛŒØ´Ù‡ Ø¨Ú¯ÛŒØ¯ Ø¯ÛŒØ´Ø¨ Ú©Ø¬Ø§ Ø±ÙØªÛŒØ¯ØŸ">could you tell me where you went last night</span>? I need a good restaurant recommendation." The agent laughed. "That\'s a funny question! But I can tell you where the <span class="highlight" data-fa-translation="Ù¾ÛŒØ´Ø®ÙˆØ§Ù† Ø­Ù…Ù„ Ùˆ Ù†Ù‚Ù„">transportation counter</span> is to get to the best food in the city."' }
            ];

            const vocabCards = [
                { id: 1, front: 'Big Cheese', back_fa: 'Ø¢Ø¯Ù… Ú©Ù„Ù‡ Ú¯Ù†Ø¯Ù‡ Ùˆ Ø¨Ø§ Ù†ÙÙˆØ°', back_en: "He acts like he's the big cheese in this office.", text_to_speak: 'Big Cheese' },
                { id: 2, front: 'Eleven grooms for one horse', back_fa: 'Ø¢ÙØªØ§Ø¨ Ù„Ú¯Ù† Ù‡ÙØª Ø§Ø³Øª Ø´Ø§Ù… Ùˆ Ù†Ø§Ù‡Ø§Ø± Ù‡ÛŒÚ†ÛŒ', back_en: "All this equipment for a simple task is like eleven grooms for one horse.", text_to_speak: 'Eleven grooms for one horse' },
                { id: 3, front: 'Groom', back_fa: 'Ù…Ù‡ØªØ± Ø§Ø³Ø¨ / Ø¯Ø§Ù…Ø§Ø¯', back_en: "The groom looked nervous before the wedding.", text_to_speak: 'Groom' },
                { id: 4, front: 'Haste makes waste', back_fa: 'Ø¹Ø¬Ù„Ù‡ Ú©Ø§Ø± Ø´ÛŒØ·ÙˆÙ†Ù‡', back_en: "You should have checked your work; haste makes waste.", text_to_speak: 'Haste makes waste' },
                { id: 5, front: 'Duty-Free Shop', back_fa: 'ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø¨Ø¯ÙˆÙ† Ø¹ÙˆØ§Ø±Ø¶ Ú¯Ù…Ø±Ú©ÛŒ', back_en: "I bought some chocolate at the duty-free shop.", text_to_speak: 'Duty-Free Shop' },
                { id: 6, front: 'Transportation Counter', back_fa: 'Ù¾ÛŒØ´Ø®ÙˆØ§Ù† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø­Ù…Ù„ Ùˆ Ù†Ù‚Ù„', back_en: "Could you tell me where the transportation counter is?", text_to_speak: 'Transportation Counter' },
                { id: 7, front: 'You need to...', back_fa: 'Ù„Ø§Ø²Ù…Ù‡/Ù†ÛŒØ§Ø²Ù‡ Ú©Ù‡... (Ù…Ù„Ø§ÛŒÙ…â€ŒØªØ± Ø§Ø² have to)', back_en: "You need to be more careful.", text_to_speak: 'You need to' },
                { id: 8, front: 'Our word is our bond', back_fa: 'Ø­Ø±ÙÙ…ÙˆÙ† Ø­Ø±ÙÙ‡ØŒ Ù‚ÙˆÙ„ Ù…Ø§ Ù‚ÙˆÙ„ Ø§Ø³Øª', back_en: "We will finish the project on time. Our word is our bond.", text_to_speak: 'Our word is our bond' },
                { id: 9, front: 'Restroom', back_fa: 'Ø³Ø±ÙˆÛŒØ³ Ø¨Ù‡Ø¯Ø§Ø´ØªÛŒ (Ø¯Ø± Ø§Ù…Ø§Ú©Ù† Ø¹Ù…ÙˆÙ…ÛŒ)', back_en: "I need to use the restroom.", text_to_speak: 'Restroom' },
                { id: 10, front: 'Hall', back_fa: 'Ø±Ø§Ù‡Ø±ÙˆØŒ Ø³Ø§Ù„Ù†', back_en: "The office is at the end of the hall.", text_to_speak: 'Hall' },
                { id: 11, front: 'He eats like a horse', back_fa: 'Ø§Ùˆ Ø®ÛŒÙ„ÛŒ Ø²ÛŒØ§Ø¯ ØºØ°Ø§ Ù…ÛŒâ€ŒØ®ÙˆØ±Ø¯', back_en: "My teenage son eats like a horse.", text_to_speak: 'He eats like a horse' }
            ];
            const grammarCards = [
                { id: 12, front: 'Ù…ÛŒØ´Ù‡ Ø¨Ù‡ Ù…Ù† Ø¨Ú¯ÛŒ Ø§Ø³Ù…Øª Ú†ÛŒÙ‡ØŸ', back_fa: 'Could you tell me what your name is?', text_to_speak: 'Could you tell me what your name is?' },
                { id: 13, front: 'Ù…ÛŒØ´Ù‡ Ø¨Ù‡ Ù…Ù† Ø¨Ú¯ÛŒ Ú†Ù†Ø¯ Ø³Ø§Ù„ØªÙ‡ØŸ', back_fa: 'Could you tell me how old you are?', text_to_speak: 'Could you tell me how old you are?' },
                { id: 14, front: 'ØªÙˆ Ù…ÛŒâ€ŒØ¯ÙˆÙ†ÛŒ Ø§ÛŒÙ† Ø®Ø§Ù†Ù… Ú©ÛŒÙ‡ØŸ', back_fa: 'Do you know who this lady is?', text_to_speak: 'Do you know who this lady is?' },
                { id: 15, front: 'Ú©Ø³ÛŒ Ù…ÛŒâ€ŒØ¯ÙˆÙ†Ù‡ Ø§ÛŒÙ† Ú†ÛŒÙ‡ØŸ', back_fa: 'Does anyone know what this is?', text_to_speak: 'Does anyone know what this is?' },
                { id: 16, front: 'Ù…ÛŒØ´Ù‡ Ø¨Ù‡ Ù…Ù† Ø¨Ú¯ÛŒ Ø¨Ø§Ù†Ú© Ú©Ø¬Ø§Ø³ØªØŸ', back_fa: 'Could you tell me where the bank is?', text_to_speak: 'Could you tell me where the bank is?' },
                { id: 17, front: 'Ù…ÛŒâ€ŒØ¯ÙˆÙ†ÛŒ Ø³Ø§Ø¹Øª Ú†Ù†Ø¯Ù‡ØŸ', back_fa: 'Do you know what time it is?', text_to_speak: 'Do you know what time it is?' },
                { id: 18, front: 'ØªÙˆ Ù…ÛŒâ€ŒØ¯ÙˆÙ†ÛŒ Ø§ÙˆÙ† Ú©ÛŒÙ‡ØŸ', back_fa: 'Do you know who he is?', text_to_speak: 'Do you know who he is?' },
                { id: 19, front: 'ØªÙˆ Ù…ÛŒâ€ŒØ¯ÙˆÙ†ÛŒ Ø§ÛŒÙ† Ø®ÙˆØ¯Ú©Ø§Ø± Ù…Ø§Ù„ Ú©ÛŒÙ‡ØŸ', back_fa: 'Do you know whose pen this is?', text_to_speak: 'Do you know whose pen this is?' },
                { id: 20, front: 'ØªÙˆ Ù…ÛŒâ€ŒØ¯ÙˆÙ†ÛŒ Ù…Ø§ÛŒÚ©Ù„ Ú©Ø¬Ø§Ø³ØªØŸ', back_fa: 'Do you know where Michael is?', text_to_speak: 'Do you know where Michael is?' },
                { id: 21, front: 'Ø¨Ø§ÛŒØ¯ Ø¨Ø¯ÙˆÙ†Ù… Ú©Ø¬Ø§ Ø¨ÙˆØ¯ÛŒ.', back_fa: 'I should know where you were.', text_to_speak: 'I should know where you were.' },
                { id: 22, front: 'ØªÙˆ Ù…ÛŒâ€ŒØ¯ÙˆÙ†ÛŒ Ù…Ø±ÛŒ Ú©Ø¬Ø§ Ø¨ÙˆØ¯ØŸ', back_fa: 'Do you know where Mary was?', text_to_speak: 'Do you know where Mary was?' },
                { id: 23, front: 'ÛŒØ§Ø¯Øª Ù‡Ø³Øª Ø§Ù…ØªØ­Ø§Ù† Ú©ÛŒ Ø¨ÙˆØ¯ØŸ', back_fa: 'Do you remember when the exam was?', text_to_speak: 'Do you remember when the exam was?' },
                { id: 24, front: 'Ù…ÛŒØ´Ù‡ Ø¨Ú¯ÛŒ Ú†Ø±Ø§ ØºØ§ÛŒØ¨ Ø¨ÙˆØ¯ÛŒØŸ', back_fa: 'Could you tell me why you were absent?', text_to_speak: 'Could you tell me why you were absent?' },
                { id: 25, front: 'ÛŒØ§Ø¯Ù… Ù†Ù…ÛŒØ§Ø¯ Ú©Ø¬Ø§ Ø¨ÙˆØ¯Ù….', back_fa: "I don't remember where I was.", text_to_speak: "I don't remember where I was." },
                { id: 26, front: 'Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø¨Ú¯ÛŒ Ú†Ø±Ø§ Ø¯Ø§Ø´ØªÛŒ Ú¯Ø±ÛŒÙ‡ Ù…ÛŒâ€ŒÚ©Ø±Ø¯ÛŒØŸ', back_fa: 'Can you tell me why you were crying?', text_to_speak: 'Can you tell me why you were crying?' },
                { id: 27, front: 'Ù…ÛŒâ€ŒØ¯ÙˆÙ†ÛŒ Ú†ÛŒ Ù…ÛŒâ€ŒØ®ÙˆØ§Ø¯ØŸ', back_fa: 'Do you know what he wants?', text_to_speak: 'Do you know what he wants?' },
                { id: 28, front: 'Ù…ÛŒØ´Ù‡ Ø¨Ù¾Ø±Ø³ÛŒ Ø§ÛŒØ´ÙˆÙ† Ú†ÛŒ Ù…ÛŒâ€ŒØ®ÙˆØ§Ø¯ØŸ', back_fa: 'Could you ask what he wants?', text_to_speak: 'Could you ask what he wants?' },
                { id: 29, front: 'Ù…ÛŒØ´Ù‡ Ø¨Ú¯ÛŒ Ú†ÛŒ Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒØ¯ØŸ', back_fa: 'Could you tell me what you want?', text_to_speak: 'Could you tell me what you want?' },
                { id: 30, front: 'Ù…ÛŒâ€ŒØ¯ÙˆÙ†ÛŒ Ú©Ø¬Ø§ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù‡ØŸ', back_fa: 'Do you know where he works?', text_to_speak: 'Do you know where he works?' },
                { id: 31, front: 'Ù…Ù† Ù…ÛŒâ€ŒØ®ÙˆØ§Ù… Ø¨Ø¯ÙˆÙ†Ù… Ø±ÙˆØ²ÛŒ Ú†Ù†Ø¯ Ø³Ø§Ø¹Øª Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†ÛŒ.', back_fa: 'I want to know how many hours a day you work.', text_to_speak: 'I want to know how many hours a day you work.' },
                { id: 32, front: 'ØªÙˆ Ù…ÛŒâ€ŒØ¯ÙˆÙ†ÛŒ Ø§ÙˆÙ† Ø¢Ø®Ø± Ù‡ÙØªÙ‡â€ŒÙ‡Ø§ Ú†ÛŒÚ©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù‡ØŸ', back_fa: 'Do you know what he does on weekends?', text_to_speak: 'Do you know what he does on weekends?' },
                { id: 33, front: 'Ø¨Ø±Ø§Ù… Ù…Ù‡Ù… Ù†ÛŒØ³Øª Ú©Ø¬Ø§ Ø²Ù†Ø¯Ú¯ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ù†.', back_fa: "I don't care where they live.", text_to_speak: "I don't care where they live." },
                { id: 34, front: 'Ø¨Ø§ÛŒØ¯ Ø¨Ø¯ÙˆÙ†ÛŒ Ø´ÙˆÙ‡Ø±Øª Ú©Ø¬Ø§ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù‡.', back_fa: 'You should know where your husband works.', text_to_speak: 'You should know where your husband works.' },
                { id: 35, front: 'Ù†Ù…ÛŒâ€ŒØ¯ÙˆÙ†Ù… ÙˆØ²Ù†Ø´ Ú†Ù‚Ø¯Ø±Ù‡.', back_fa: "I don't know how much he weighs.", text_to_speak: "I don't know how much he weighs." },
                { id: 36, front: 'Ù…ÛŒØ´Ù‡ Ø¨Ú¯ÛŒ Ú†Ù†Ø¯ ÙˆÙ‚Øª ÛŒÚ©Ø¨Ø§Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù…ÛŒØ§ÛŒØŸ', back_fa: 'Could you tell me how often you come here?', text_to_speak: 'Could you tell me how often you come here?' },
                { id: 37, front: 'Ø¨Ø§ÛŒØ¯ Ø¨Ø¯ÙˆÙ†Ù… Ø§ÙˆÙ† Ú†Ù†Ø¯ ÙˆÙ‚Øª ÛŒÚ©Ø¨Ø§Ø± Ù…Ø§Ù…ÙˆØ±ÛŒØª Ù…ÛŒØ±Ù‡.', back_fa: 'I should know how often he goes on a mission.', text_to_speak: 'I should know how often he goes on a mission.' },
                { id: 38, front: 'Ù…ÛŒâ€ŒØ¯ÙˆÙ†ÛŒ Ø³Ø§Ø¹Øª Ú†Ù†Ø¯ Ø¨Ø§Ø² Ù…ÛŒØ´Ù‡ØŸ', back_fa: 'Do you know what time it opens?', text_to_speak: 'Do you know what time it opens?' },
                { id: 39, front: 'ØªÙˆ Ù…ÛŒâ€ŒØ¯ÙˆÙ†ÛŒ Ú†Ø±Ø§ Ø¯Ø§Ø±Ù‡ Ù…ÛŒâ€ŒØ®Ù†Ø¯Ù‡ØŸ', back_fa: 'Do you know why he is laughing?', text_to_speak: 'Do you know why he is laughing?' },
                { id: 40, front: 'Ù…ÛŒØ´Ù‡ Ø¨Ú¯ÛŒ Ø¯Ø§Ø±ÛŒ Ú†ÛŒÚ©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†ÛŒØŸ', back_fa: 'Could you tell me what you are doing?', text_to_speak: 'Could you tell me what you are doing?' },
                { id: 41, front: 'Ø¨Ù‡ Ù…Ù† Ø¨Ú¯Ùˆ Ú†Ø±Ø§ Ø¯Ø§Ø±ÛŒ Ù…ÛŒØ±ÛŒ Ø¨ÛŒØ±ÙˆÙ†.', back_fa: 'Tell me why you are going out.', text_to_speak: 'Tell me why you are going out.' },
                { id: 42, front: 'Ù…ÛŒâ€ŒØ®ÙˆØ§Ù… Ø¨Ø¯ÙˆÙ†Ù… Ø§ÙˆÙ† Ú©Ø¬Ø§ Ù…ÛŒØ±Ù‡.', back_fa: 'I want to know where she is going.', text_to_speak: 'I want to know where she is going.' },
                { id: 43, front: 'Ù…ÛŒØ´Ù‡ Ø¨Ú¯ÛŒ Ú†ÛŒÚ©Ø§Ø± Ú©Ø±Ø¯ÛŒØŸ', back_fa: 'Could you tell me what you have done?', text_to_speak: 'Could you tell me what you have done?' },
                { id: 44, front: 'Ù…ÛŒâ€ŒØ¯ÙˆÙ†ÛŒ Ú©Ø¬Ø§ Ø±ÙØªÙ‡ØŸ', back_fa: 'Do you know where he has gone?', text_to_speak: 'Do you know where he has gone?' },
                { id: 45, front: 'Ù…ÛŒØ´Ù‡ Ø¨Ø¨ÛŒÙ†Ù… Ú†ÛŒ Ø²Ø¯Ù‡ØŸ', back_fa: 'Could I see what he has injected?', text_to_speak: 'Could I see what he has injected?' },
                { id: 46, front: 'ØªÙˆ Ù…ÛŒâ€ŒØ¯ÙˆÙ†ÛŒ Ù¾Ø¯Ø±Øª Ú©Ø¬Ø§ Ø±ÙØªÙ‡ØŸ', back_fa: 'Do you know where your father has gone?', text_to_speak: 'Do you know where your father has gone?' },
                { id: 47, front: 'Ø¨Ú¯Ùˆ Ú†ÛŒ Ø®ÙˆØ±Ø¯ÛŒ.', back_fa: 'Tell me what you have eaten.', text_to_speak: 'Tell me what you have eaten.' },
                { id: 48, front: 'Ù…ÛŒâ€ŒØ®ÙˆØ§Ù… Ø¨Ø¯ÙˆÙ†Ù… Ú†ÛŒ Ø®Ø±ÛŒØ¯ÛŒ.', back_fa: 'I want to know what you have bought.', text_to_speak: 'I want to know what you have bought.' },
                { id: 49, front: 'Ù…ÛŒâ€ŒØ¯ÙˆÙ†ÛŒ Ú†Ø±Ø§ Ø·Ù„Ø§Ù‚ Ú¯Ø±ÙØªÙ†ØŸ', back_fa: 'Do you know why they have gotten divorced?', text_to_speak: 'Do you know why they have gotten divorced?' },
                { id: 50, front: 'Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø¨Ú¯ÛŒ Ù…Ø§Ø´ÛŒÙ†Ùˆ Ú©Ø¬Ø§ Ù¾Ø§Ø±Ú© Ú©Ø±Ø¯ÛŒØŸ', back_fa: 'Can you tell me where you have parked the car?', text_to_speak: 'Can you tell me where you have parked the car?' },
                { id: 51, front: 'Ù…ÛŒØ´Ù‡ Ø¨Ú¯ÛŒ Ú©Ø¬Ø§ Ù…ÛŒâ€ŒØªÙˆÙ†Ù… Ø¨Ø´ÛŒÙ†Ù…ØŸ', back_fa: 'Could you tell me where I can sit?', text_to_speak: 'Could you tell me where I can sit?' },
                { id: 52, front: 'Ù…ÛŒØ´Ù‡ Ø¨Ú¯ÛŒ Ú†ÛŒÚ©Ø§Ø± Ø¨Ø§ÛŒØ¯ Ø¨Ú©Ù†Ù…ØŸ', back_fa: 'Could you tell me what I should do?', text_to_speak: 'Could you tell me what I should do?' },
                { id: 53, front: 'Ø¨Ù‡Ù… Ù…ÛŒÚ¯ÛŒ Ù‚Ø±Ø§Ø±Ù‡ Ú†ÛŒÚ©Ø§Ø± Ú©Ù†ÛŒØŸ', back_fa: 'Will you tell me what you are going to do?', text_to_speak: 'Will you tell me what you are going to do?' },
                { id: 54, front: 'Ù…ÛŒâ€ŒØ®ÙˆØ§Ù… Ø¨Ø¯ÙˆÙ†Ù… Ú†Ù‡ Ø³Ø§Ø¹ØªÛŒ Ù‚Ø±Ø§Ø±Ù‡ Ø¨Ù‡Ù… Ø²Ù†Ú¯ Ø¨Ø²Ù†ÛŒ.', back_fa: 'I would like to know what time you are going to call me.', text_to_speak: 'I would like to know what time you are going to call me.' },
                { id: 55, front: 'Ù…ÛŒØ´Ù‡ Ø¨Ú¯ÛŒ Ú©Ø¬Ø§ Ù‚Ø±Ø§Ø±Ù‡ Ø¨Ø±ÛŒØŸ', back_fa: 'Could you tell me where you are going to go?', text_to_speak: 'Could you tell me where you are going to go?' },
                { id: 56, front: 'Ù…ÛŒâ€ŒØ¯ÙˆÙ†ÛŒ Ù…Ù† Ø¨Ø§ÛŒØ¯ Ú†ÛŒÚ©Ø§Ø± Ú©Ù†Ù…ØŸ', back_fa: 'Do you know what I should do?', text_to_speak: 'Do you know what I should do?' },
                { id: 57, front: 'Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ Ù…Ù† Ø¨Ú¯ÛŒ Ú©Ø¬Ø§ Ù…ÛŒØ±ÛŒ.', back_fa: 'You should tell me where you are going.', text_to_speak: 'You should tell me where you are going.' },
                { id: 58, front: 'Ù…ÛŒØ´Ù‡ Ø¨Ú¯ÛŒ Ø¯ÛŒØ´Ø¨ Ú©Ø¬Ø§ Ø±ÙØªÛŒØŸ', back_fa: 'Could you tell me where you went last night?', text_to_speak: 'Could you tell me where you went last night?' },
                { id: 59, front: 'Ù…ÛŒâ€ŒØ®ÙˆØ§Ù… Ø¨Ø¯ÙˆÙ†Ù… Ú†ÛŒ Ø®Ø±ÛŒØ¯ÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø§Ø¯Ø±Øª.', back_fa: 'I want to know what you bought for your mother.', text_to_speak: 'I want to know what you bought for your mother.' },
                { id: 60, front: 'Ù…ÛŒâ€ŒØ¯ÙˆÙ†ÛŒ Ø§ÙˆÙ†Ø§ Ú©ÛŒ Ø±Ø³ÛŒØ¯Ù†ØŸ', back_fa: 'Do you know when they arrived?', text_to_speak: 'Do you know when they arrived?' },
                { id: 61, front: 'Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø¨Ú¯ÛŒ Ú†Ø·ÙˆØ± Ù„Ø§ØºØ± Ú©Ø±Ø¯ÛŒØŸ', back_fa: 'Can you tell me how you lost weight?', text_to_speak: 'Can you tell me how you lost weight?' },
                { id: 62, front: 'Ù…ÛŒâ€ŒØ®ÙˆØ§Ù… Ø¨Ø¯ÙˆÙ†Ù… Ú©Ø¯ÙˆÙ… Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±Ø¯ÛŒ.', back_fa: 'I want to know which one you chose.', text_to_speak: 'I want to know which one you chose.' },
                { id: 63, front: 'Ù…ÛŒØ´Ù‡ Ø¨Ú¯ÛŒ Ú†Ù‡ Ø³Ø§Ø¹ØªÛŒ Ø¨ÛŒØ¯Ø§Ø± Ø´Ø¯ÛŒØŸ', back_fa: 'Could you tell me what time you woke up?', text_to_speak: 'Could you tell me what time you woke up?' },
                { id: 64, front: 'Ú©ÛŒ ØªÙˆ Ø±Ùˆ Ø¯ÙˆØ³Øª Ø¯Ø§Ø±Ù‡ØŸ', back_fa: 'Do you know who likes you?', text_to_speak: 'Do you know who likes you?' },
                { id: 65, front: 'Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ø´Ø±Ú©Øª Ø³ÙˆÙ†ÛŒ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù‡ØŸ', back_fa: 'Do you know who works for Sony company?', text_to_speak: 'Do you know who works for Sony company?' },
                { id: 66, front: 'Ù…ÛŒØ´Ù‡ Ø¨Ú¯ÛŒ ØªÙˆ Ú©ÛŒ Ù‡Ø³ØªÛŒØŸ', back_fa: 'Could you tell me who you are?', text_to_speak: 'Could you tell me who you are?' },
                { id: 67, front: 'Ù…ÛŒâ€ŒØ¯ÙˆÙ†ÛŒ Ù…Ù† Ú©ÛŒ Ù‡Ø³ØªÙ…ØŸ', back_fa: 'Do you know who I am?', text_to_speak: 'Do you know who I am?' }
            ];
            
            // --- App State & Functions ---
            let currentSession = { cards: [], currentIndex: 0, type: '', knownCount: 0, unknownCount: 0 };
            let preferredVoice = null;
            let voices = [];

            function loadAndSetVoice() {
                voices = window.speechSynthesis.getVoices();
                preferredVoice = voices.find(v => v.name.includes('Google') && v.lang.startsWith('en')) || voices.find(v => v.lang.startsWith('en') && !v.localService) || voices.find(v => v.lang.startsWith('en')) || voices[0];
            }
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadAndSetVoice;
            }
            loadAndSetVoice();

            function speakText(text) {
                if (voices.length === 0) loadAndSetVoice();
                const utter = new SpeechSynthesisUtterance(text);
                utter.voice = preferredVoice;
                utter.lang = preferredVoice?.lang || 'en-US';
                utter.rate = 0.9;
                utter.pitch = 1;
                window.speechSynthesis.speak(utter);
            }

            function showCard(index) {
                if (index >= currentSession.cards.length) {
                    showResults();
                    return;
                }
                const cardData = currentSession.cards[index];
                const cardFront = document.getElementById('card-front');
                const cardBack = document.getElementById('card-back');
                const flashcard = document.querySelector('#practice-view .flashcard');
                flashcard.classList.remove('is-flipped');
                interactiveButtons.classList.remove('hidden');
                prevCardBtn.style.visibility = (index > 0) ? 'visible' : 'hidden';
                nextCardBtn.style.visibility = 'hidden';
                setTimeout(() => {
                    if (currentSession.type === 'vocab') {
                        cardFront.innerHTML = `<h3 class="text-xl font-semibold p-4">${cardData.back_fa}</h3>`;
                        cardBack.innerHTML = `<div class="p-4 flex-grow flex flex-col justify-center items-center"><p class="text-2xl font-bold">${cardData.front}</p><p class="text-base italic mt-2 text-slate-600">"${cardData.back_en}"</p><div class="flex gap-4"><button class="pronunciation-button" data-text="${cardData.text_to_speak}"><i class="fa-solid fa-volume-high"></i><span>Ú©Ù„Ù…Ù‡</span></button><button class="pronunciation-button" data-text="${cardData.back_en}"><i class="fa-solid fa-volume-high"></i><span>Ù…Ø«Ø§Ù„</span></button></div></div>`;
                    } else {
                        cardFront.innerHTML = `<h3 class="text-xl font-bold p-4">${cardData.front}</h3>`;
                        cardBack.innerHTML = `<div class="p-4 flex-grow flex flex-col justify-center items-center"><p class="font-bold text-lg">${cardData.back_fa}</p><button class="pronunciation-button" data-text="${cardData.text_to_speak}"><i class="fa-solid fa-volume-high"></i><span>ØªÙ„ÙØ¸</span></button></div>`;
                    }
                }, 150);
                cardCounter.textContent = `${index + 1} / ${currentSession.cards.length}`;
            }

            function renderLesson() {
                const backButton = lessonContentContainer.querySelector('.back-to-menu-btn').parentElement;
                lessonContentContainer.innerHTML = '';
                if (lesson33Content.length > 0 && lesson33Content[0].type === 'raw_html') {
                    const item = lesson33Content[0];
                    lessonContentContainer.innerHTML = item.html;
                    lessonContentContainer.appendChild(backButton);
                    const oldScript = document.getElementById('lesson-script');
                    if (oldScript) oldScript.remove();
                    if (item.script) {
                        const newScript = document.createElement('script');
                        newScript.id = 'lesson-script';
                        newScript.innerHTML = item.script;
                        document.body.appendChild(newScript);
                    }
                } else {
                    lessonContentContainer.innerHTML = '<p class="text-center text-slate-500">Ù…Ø­ØªÙˆØ§ÛŒ Ø¯Ø±Ø³ Ù‡Ù†ÙˆØ² Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>';
                    lessonContentContainer.appendChild(backButton);
                }
            }

            function renderStory() {
                const backButton = storyContentContainer.querySelector('.back-to-menu-btn').parentElement;
                storyContentContainer.innerHTML = '';
                if (storyContent.length === 0) {
                    storyContentContainer.innerHTML = '<p class="text-center text-slate-500">Ù…Ø­ØªÙˆØ§ÛŒ Ø¯Ø§Ø³ØªØ§Ù† Ù‡Ù†ÙˆØ² Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>';
                    storyContentContainer.appendChild(backButton);
                    return;
                }
                storyContent.forEach(item => {
                    let el;
                    switch (item.type) {
                        case 'h2':
                            el = document.createElement('h2');
                            el.className = 'text-3xl font-bold text-center mb-10';
                            el.textContent = item.text;
                            break;
                        case 'p':
                            el = document.createElement('p');
                            el.innerHTML = item.text;
                            break;
                    }
                    if (el) storyContentContainer.appendChild(el);
                });
                storyContentContainer.appendChild(backButton);
                storyContentContainer.querySelectorAll('.highlight').forEach(highlightEl => {
                    const translation = highlightEl.dataset.faTranslation;
                    if (translation) {
                        const tooltip = document.createElement('span');
                        tooltip.className = 'tooltip-text';
                        tooltip.textContent = translation;
                        highlightEl.appendChild(tooltip);
                    }
                });
            }

            function startPractice(type) {
                mainMenuView.classList.add('hidden');
                resultsView.classList.add('hidden');
                storyView.classList.add('hidden');
                lessonView.classList.add('hidden');
                practiceView.classList.remove('hidden');
                practiceView.classList.add('fade-in');
                let cardsToPractice = [];
                if (type === 'vocab') {
                    cardsToPractice = vocabCards;
                    headerSubtitle.textContent = 'ØªÙ…Ø±ÛŒÙ† Ú©Ù„Ù…Ø§Øª Ùˆ Ø§ØµØ·Ù„Ø§Ø­Ø§Øª';
                } else if (type === 'grammar') {
                    cardsToPractice = grammarCards;
                    headerSubtitle.textContent = 'ØªÙ…Ø±ÛŒÙ† Ú¯Ø±Ø§Ù…Ø±';
                }
                if (cardsToPractice.length === 0) {
                    document.getElementById('review-area').innerHTML = '<p class="text-center text-slate-500 py-10">Ù‡ÛŒÚ† Ú©Ø§Ø±ØªÛŒ Ø¨Ø±Ø§ÛŒ ØªÙ…Ø±ÛŒÙ† Ø¯Ø± Ø§ÛŒÙ† Ø¨Ø®Ø´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>';
                    return;
                }
                currentSession.cards = shuffleArray([...cardsToPractice]);
                currentSession.type = type;
                currentSession.currentIndex = 0;
                currentSession.knownCount = 0;
                currentSession.unknownCount = 0;
                showCard(0);
            }

            function showLesson() {
                mainMenuView.classList.add('hidden');
                practiceView.classList.add('hidden');
                resultsView.classList.add('hidden');
                storyView.classList.add('hidden');
                lessonView.classList.remove('hidden');
                lessonView.classList.add('fade-in');
                headerSubtitle.textContent = 'Ø¯Ø±Ø³ Ø¬Ù„Ø³Ù‡ Û³Û³';
                renderLesson();
            }

            function showStory() {
                mainMenuView.classList.add('hidden');
                practiceView.classList.add('hidden');
                resultsView.classList.add('hidden');
                lessonView.classList.add('hidden');
                storyView.classList.remove('hidden');
                storyView.classList.add('fade-in');
                headerSubtitle.textContent = 'Ø¯Ø§Ø³ØªØ§Ù† Ø¬Ù„Ø³Ù‡ Û³Û³';
                renderStory();
            }

            function goBackToMenu() {
                practiceView.classList.add('hidden');
                lessonView.classList.add('hidden');
                storyView.classList.add('hidden');
                resultsView.classList.add('hidden');
                mainMenuView.classList.remove('hidden');
                mainMenuView.classList.add('fade-in');
                headerSubtitle.textContent = 'ÛŒÚ© Ø¨Ø®Ø´ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ ØªÙ…Ø±ÛŒÙ† Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.';
            }

            function showResults() {
                practiceView.classList.add('hidden');
                resultsView.classList.remove('hidden');
                resultsView.classList.add('fade-in');
                headerSubtitle.textContent = 'Ù†ØªØ§ÛŒØ¬ ØªÙ…Ø±ÛŒÙ† Ø´Ù…Ø§';
                const totalCards = currentSession.cards.length;
                const knownPercentage = totalCards > 0 ? ((currentSession.knownCount / totalCards) * 100).toFixed(0) : 0;
                const unknownPercentage = totalCards > 0 ? ((currentSession.unknownCount / totalCards) * 100).toFixed(0) : 0;
                resultsStats.innerHTML = `<p class="mb-2">ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§: ${totalCards}</p><p class="text-green-600 font-bold mb-1">Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ù„Ø¯ Ø¨ÙˆØ¯Ù…: ${currentSession.knownCount} (${knownPercentage}%)</p><p class="text-red-600 font-bold">Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ù„Ø¯ Ù†Ø¨ÙˆØ¯Ù…: ${currentSession.unknownCount} (${unknownPercentage}%)</p>`;
            }

            async function saveStats() {
                if (!firebaseInitialized || !userId) {
                    saveMessage.textContent = 'Ø®Ø·Ø§: Ø§Ù…Ú©Ø§Ù† Ø°Ø®ÛŒØ±Ù‡ Ù†ØªØ§ÛŒØ¬ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.';
                    return;
                }
                try {
                    const statsCollection = collection(db, `artifacts/${appId}/users/${userId}/flashcard_stats`);
                    await addDoc(statsCollection, {
                        known: currentSession.knownCount,
                        unknown: currentSession.unknownCount,
                        total: currentSession.cards.length,
                        type: currentSession.type,
                        timestamp: new Date()
                    });
                    saveMessage.textContent = 'Ù†ØªØ§ÛŒØ¬ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯! ğŸ‰';
                    saveResultsBtn.disabled = true;
                    saveResultsBtn.classList.add('opacity-50', 'cursor-not-allowed');
                } catch (e) {
                    console.error("Error adding document: ", e);
                    saveMessage.textContent = 'Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù†ØªØ§ÛŒØ¬.';
                }
            }

            function navigateCards(direction) {
                const newIndex = currentSession.currentIndex + direction;
                if (newIndex >= 0 && newIndex < currentSession.cards.length) {
                    currentSession.currentIndex = newIndex;
                    showCard(newIndex);
                } else if (newIndex >= currentSession.cards.length) {
                    showResults();
                }
            }

            function handleFeedback(isKnewIt) {
                document.querySelector('#practice-view .flashcard').classList.add('is-flipped');
                interactiveButtons.classList.add('hidden');
                nextCardBtn.style.visibility = 'visible';
                if (isKnewIt) {
                    currentSession.knownCount++;
                } else {
                    currentSession.unknownCount++;
                }
            }
            
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // --- EVENT LISTENERS ---
            startLesson33Btn.addEventListener('click', showLesson);
            startStoryBtn.addEventListener('click', showStory);
            startVocabBtn.addEventListener('click', () => startPractice('vocab'));
            startGrammarBtn.addEventListener('click', () => startPractice('grammar'));
            backToMenuBtns.forEach(btn => btn.addEventListener('click', goBackToMenu));
            knewItBtn.addEventListener('click', () => handleFeedback(true));
            didNotKnowBtn.addEventListener('click', () => handleFeedback(false));
            nextCardBtn.addEventListener('click', () => navigateCards(1));
            prevCardBtn.addEventListener('click', () => navigateCards(-1));
            flashcardDisplay.addEventListener('click', function(event) {
                const flashcard = this.querySelector('.flashcard');
                if (!event.target.closest('.pronunciation-button') && !flashcard.classList.contains('is-flipped')) {
                    flashcard.classList.add('is-flipped');
                }
            });
            document.body.addEventListener('click', function(event) {
                const pronunciationButton = event.target.closest('.pronunciation-button, .play-translation');
                if (pronunciationButton) {
                    event.stopPropagation();
                    const textToSpeak = pronunciationButton.dataset.text;
                    if (textToSpeak) {
                        speakText(textToSpeak);
                    }
                }
            });
            saveResultsBtn.addEventListener('click', saveStats);
        });
    </script>
</body>
</html>
