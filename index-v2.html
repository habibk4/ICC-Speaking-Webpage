<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Speaking ICC</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Vazirmatn -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <!-- Google Sign-In API -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        /* General Styles */
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #f8fafc;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Cg fill-rule='evenodd'%3E%3Cg fill='%23e2e8f0' fill-opacity='0.4'%3E%3Cpath d='M0 38.59l2.83-2.83 1.41 1.41L1.41 40H0v-1.41zM0 1.4l2.83 2.83 1.41-1.41L1.41 0H0v1.41zM38.59 40l-2.83-2.83 1.41-1.41L40 38.59V40h-1.41zM40 1.41l-2.83 2.83-1.41-1.41L38.59 0H40v1.41z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        .glassmorphism {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .gradient-text {
            background-image: linear-gradient(to left, #4f46e5, #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .session-link.active {
            background-image: linear-gradient(to left, #4f46e5, #6366f1);
            color: white;
            font-weight: 700;
            transform: scale(1.05);
            box-shadow: 0 4px 15px -3px rgba(79, 70, 229, 0.4);
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- Main Application Container -->
    <div id="app-container">
        <!-- Header -->
        <header class="glassmorphism shadow-sm sticky top-0 z-30">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <a href="https://habibk4.github.io/ICC-Speaking-Webpage/" class="text-xl sm:text-2xl font-bold gradient-text cursor-pointer no-underline">
                    خلاصه کلاس Speaking ICC
                </a>
                <div class="flex items-center gap-4">
                    <!-- Login Button -->
                    <div id="login-button-container" class="hidden">
                        <div id="g_id_onload"
                             data-client_id="237587578389-ggirbrqh3ace9aura1fd6ipa5m2bepco.apps.googleusercontent.com"
                             data-callback="handleCredentialResponse"
                             data-auto_prompt="false">
                        </div>
                        <div class="g_id_signin"
                             data-type="standard"
                             data-size="large"
                             data-theme="outline"
                             data-text="sign_in_with"
                             data-shape="rectangular"
                             data-logo_alignment="left">
                        </div>
                    </div>
                    <!-- User profile and logout button -->
                    <div id="user-profile-actions" class="flex items-center gap-4 hidden">
                        <div id="user-display-info" class="flex items-center gap-2">
                            <!-- User image and name will be injected here -->
                        </div>
                        <button id="logout-button" class="px-4 py-2 text-sm font-bold text-white bg-red-500 hover:bg-red-600 rounded-lg transition-colors">
                            خروج
                        </button>
                    </div>
                    <button id="mobile-menu-button" class="md:hidden p-2 rounded-md text-slate-600 hover:bg-slate-100 focus:outline-none">
                        <i class="fa-solid fa-bars fa-lg"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Body -->
        <div class="container mx-auto px-4 py-6">
            <div class="flex flex-row-reverse gap-8">
                <!-- Sidebar Navigation -->
                <aside id="sidebar" class="fixed top-0 right-0 h-full z-50 w-72 glassmorphism p-5 shadow-lg transform-gpu translate-x-full transition-transform duration-300 md:relative md:h-auto md:self-start md:top-auto md:translate-x-0 md:z-auto md:!shadow-none md:!bg-transparent md:p-0">
                    <div class="mb-4 pb-2 border-b border-slate-200">
                        <h2 class="font-bold text-lg text-slate-800 flex items-center gap-2"><i class="fa-solid fa-book-open text-indigo-500"></i>سرفصل دروس</h2>
                    </div>
                    <nav>
                        <ul class="space-y-2" id="menu-container">
                            <!-- Menu items will be generated by JavaScript -->
                        </ul>
                    </nav>
                </aside>

                <!-- Main Content -->
                <main class="flex-1">
                    <div id="content-area" class="bg-white rounded-2xl shadow-lg min-h-[80vh] overflow-hidden">
                        <!-- Homepage Content -->
                        <div class="relative text-white h-full min-h-[80vh] flex flex-col justify-center items-center text-center p-6" 
                             style="background-image: url('uploaded:ICC-Class.jpg-162917d4-3037-4aba-bc4c-b16f5c106c3f'); background-size: cover; background-position: center;"
                             onerror="this.style.backgroundImage='url(https://placehold.co/1000x800/d1d5db/374151?text=Image+Not+Found)';">
                            <div class="absolute inset-0 bg-black/50"></div>
                            <div class="relative z-10 fade-in">
                                <h2 class="text-4xl md:text-5xl font-bold mb-3">سفر من در دنیای مکالمه!</h2>
                                <p class="text-lg max-w-xl mx-auto text-slate-200 leading-relaxed">
                                    اینجا قراره چکیده‌ای از چیزایی که تو هر جلسه یاد می‌گیرم رو بنویسم. این سایت به مرور کامل‌تر می‌شه، پس حتما دوباره سر بزن!
                                </p>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="mt-12 border-t-2 border-slate-200 bg-white">
            <div class="container mx-auto px-6 py-8 text-center text-slate-600">
                <p class="font-semibold text-lg">از این آرشیو برای مرور و یادگیری بهتر استفاده کنید!</p>
                <p class="mt-2">برای هرگونه پیشنهاد یا سوال، با من در تماس باشید:</p>
                <a href="mailto:Habibkamaie@gmail.com" class="mt-2 inline-block text-indigo-600 font-bold hover:underline">Habibkamaie@gmail.com</a>
                <p class="mt-6 text-sm text-slate-500">
                    &copy; <span id="copyright-year"></span> | تمامی حقوق برای حبیب کمایی محفوظ است.
                </p>
            </div>
        </footer>
    </div>

    <!-- Sidebar Overlay -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black/60 z-40 hidden md:hidden"></div>

    <script>
        // --- SCRIPT ---
        const baseURL = 'https://habibk4.github.io/ICC-Speaking-Webpage/';
        const menuContainer = document.getElementById('menu-container');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const sidebar = document.getElementById('sidebar');
        const copyrightYear = document.getElementById('copyright-year');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        const loginButtonContainer = document.getElementById('login-button-container');
        const userProfileActions = document.getElementById('user-profile-actions');
        const logoutButton = document.getElementById('logout-button');
        const userDisplayInfo = document.getElementById('user-display-info');
        
        /**
         * Parses the JWT token to get user data.
         * @param {string} token The JWT token from Google.
         * @returns {object} The parsed user data.
         */
        function parseJwt(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(window.atob(base64).split('').map(c =>
                '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)
            ).join(''));
            return JSON.parse(jsonPayload);
        }

        /**
         * Handles the Google Sign-In response.
         * @param {object} response The response object from Google.
         */
        function handleCredentialResponse(response) {
            const data = parseJwt(response.credential);
            
            // Store user data in localStorage to persist the session
            localStorage.setItem('userData', JSON.stringify(data));
            
            // Update the UI
            checkLoginStatus();
        }

        /**
         * Logs the user out by clearing localStorage and refreshing the state.
         */
        function logout() {
            localStorage.removeItem('userData');
            checkLoginStatus();
        }

        /**
         * Displays the user's information in the header.
         * @param {object} userData The user data to display.
         */
        function displayUserInfo(userData) {
            if (userDisplayInfo) {
                userDisplayInfo.innerHTML = `
                    <img src="${userData.picture}" alt="Profile" class="w-8 h-8 rounded-full">
                    <span class="font-medium text-sm hidden sm:inline">${userData.given_name}</span>
                `;
            }
        }

        /**
         * Checks for an existing user session on page load and updates the UI accordingly.
         */
        function checkLoginStatus() {
            const userData = JSON.parse(localStorage.getItem('userData'));
            if (userData) {
                // User is already logged in, show user profile and logout button
                loginButtonContainer.classList.add('hidden');
                userProfileActions.classList.remove('hidden');
                displayUserInfo(userData);
            } else {
                // User is not logged in, show login button
                loginButtonContainer.classList.remove('hidden');
                userProfileActions.classList.add('hidden');
                userDisplayInfo.innerHTML = '';
            }
        }

        /**
         * این تابع منوی جلسات را به صورت پویا ایجاد می‌کند.
         */
        function createMenu() {
            // Clear any existing menu items before creating new ones
            menuContainer.innerHTML = '';

            // This variable tracks the session number for link creation, starting from 1.
            let sessionCounter = 1;

            // This loop runs to create 5 terms.
            for (let term = 1; term <= 5; term++) {
                const termLi = document.createElement('li');
                const termButton = document.createElement('button');
                termButton.className = 'w-full flex justify-between items-center p-3 text-right font-bold text-slate-700 hover:bg-slate-100 rounded-lg transition-all';
                termButton.innerHTML = `<span class="flex items-center gap-2"><i class="fa-solid fa-folder text-amber-500"></i> ترم ${term}</span><svg class="w-5 h-5 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>`;
                
                const sessionsUl = document.createElement('ul');
                sessionsUl.className = 'accordion-content pr-4 mt-1 space-y-1';

                // This loop runs to create 10 sessions in each term.
                for (let session = 1; session <= 10; session++) {
                    const sessionLi = document.createElement('li');
                    const sessionLink = document.createElement('a');
                    
                    // Here, the link for each session is created.
                    // For example: https://.../session-1.html, https://.../session-2.html, and so on up to 50.
                    sessionLink.href = `${baseURL}session-${sessionCounter}.html`; 
                    sessionLink.innerHTML = `<i class="fa-solid fa-file-lines fa-xs ml-2 text-slate-400"></i> جلسه ${sessionCounter}`;
                    sessionLink.className = 'session-link block p-2 text-slate-600 hover:bg-indigo-100 hover:text-indigo-700 rounded-md transition-colors duration-200';
                    
                    sessionLi.appendChild(sessionLink);
                    sessionsUl.appendChild(sessionLi);

                    // The session number is incremented for the next link.
                    sessionCounter++;
                }

                termLi.appendChild(termButton);
                termLi.appendChild(sessionsUl);
                menuContainer.appendChild(termLi);

                // Event listener for accordion functionality
                termButton.addEventListener('click', () => {
                    const content = termButton.nextElementSibling;
                    const icon = termButton.querySelector('svg');
                    
                    // Toggle the current accordion
                    const isCurrentlyExpanded = content.style.maxHeight !== '';
                    if (isCurrentlyExpanded) {
                        content.style.maxHeight = null;
                        icon.style.transform = 'rotate(0deg)';
                    } else {
                        // Close all other accordions first
                        document.querySelectorAll('.accordion-content').forEach(el => {
                            el.style.maxHeight = null;
                            const prevIcon = el.previousElementSibling.querySelector('svg');
                            if (prevIcon) {
                                prevIcon.style.transform = 'rotate(0deg)';
                            }
                        });
                        // Open the clicked one
                        content.style.maxHeight = content.scrollHeight + "px";
                        icon.style.transform = 'rotate(180deg)';
                    }
                });
            }
        }

        /**
         * This function finds the link for the current page in the menu and highlights it.
         */
        function updateActiveLink() {
            const currentPage = window.location.href.split('?')[0].split('#')[0];

            // If the URL doesn't contain 'session-', we are on the homepage and do nothing.
            if (!currentPage.includes('session-')) {
                return;
            }

            // Find the link corresponding to the current page.
            const activeLink = document.querySelector(`.session-link[href="${currentPage}"]`);
            if (activeLink) {
                activeLink.classList.add('active');
                
                // Open the accordion for the active session's term.
                const parentAccordion = activeLink.closest('.accordion-content');
                if (parentAccordion && !parentAccordion.style.maxHeight) {
                    parentAccordion.previousElementSibling.click();
                }
            }
        }

        /**
         * This function controls the display of the sidebar on mobile.
         */
        function toggleSidebar() {
            sidebar.classList.toggle('translate-x-full');
            sidebarOverlay.classList.toggle('hidden');
        }

        // --- Event Listeners & Initializations ---
        mobileMenuButton.addEventListener('click', (e) => { 
            e.stopPropagation(); 
            toggleSidebar(); 
        });
        sidebarOverlay.addEventListener('click', toggleSidebar);
        logoutButton.addEventListener('click', logout);

        // Set current year in footer
        copyrightYear.textContent = new Date().getFullYear();
        
        // Initial app setup
        window.onload = () => {
            checkLoginStatus();
            createMenu();
            updateActiveLink();
        };
    </script>
</body>
</html>
